/*
 * Falcon signature verification.
 *
 * ==========================(LICENSE BEGIN)============================
 *
 * Copyright (c) 2017-2019  Falcon Project
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * ===========================(LICENSE END)=============================
 *
 * @author   Thomas Pornin <thomas.pornin@nccgroup.com>
 */

#include "inner.h"
#include <iostream>

/* ===================================================================== */
/*
 * Constants for NTT.
 *
 *   n = 2^logn  (2 <= n <= 1024)
 *   phi = X^n + 1
 *   q = 12289
 *   q0i = -1/q mod 2^16
 *   R = 2^16 mod q
 *   R2 = 2^32 mod q
 */

#define Q     12289
#define Q0I   12287
#define R      4091
#define R2    10952

#define Q_l    12884901889
#define Q0I_large 18431

/*
 * Table for NTT, binary case:
 *   GMb[x] = R*(g^rev(x)) mod q
 * where g = 7 (it is a 2048-th primitive root of 1 modulo q)
 * and rev() is the bit-reversal function over 10 bits.
 */
static const uint16_t GMb[] = {
	 4091,  7888, 11060, 11208,  6960,  4342,  6275,  9759,
	 1591,  6399,  9477,  5266,   586,  5825,  7538,  9710,
	 1134,  6407,  1711,   965,  7099,  7674,  3743,  6442,
	10414,  8100,  1885,  1688,  1364, 10329, 10164,  9180,
	12210,  6240,   997,   117,  4783,  4407,  1549,  7072,
	 2829,  6458,  4431,  8877,  7144,  2564,  5664,  4042,
	12189,   432, 10751,  1237,  7610,  1534,  3983,  7863,
	 2181,  6308,  8720,  6570,  4843,  1690,    14,  3872,
	 5569,  9368, 12163,  2019,  7543,  2315,  4673,  7340,
	 1553,  1156,  8401, 11389,  1020,  2967, 10772,  7045,
	 3316, 11236,  5285, 11578, 10637, 10086,  9493,  6180,
	 9277,  6130,  3323,   883, 10469,   489,  1502,  2851,
	11061,  9729,  2742, 12241,  4970, 10481, 10078,  1195,
	  730,  1762,  3854,  2030,  5892, 10922,  9020,  5274,
	 9179,  3604,  3782, 10206,  3180,  3467,  4668,  2446,
	 7613,  9386,   834,  7703,  6836,  3403,  5351, 12276,
	 3580,  1739, 10820,  9787, 10209,  4070, 12250,  8525,
	10401,  2749,  7338, 10574,  6040,   943,  9330,  1477,
	 6865,  9668,  3585,  6633, 12145,  4063,  3684,  7680,
	 8188,  6902,  3533,  9807,  6090,   727, 10099,  7003,
	 6945,  1949,  9731, 10559,  6057,   378,  7871,  8763,
	 8901,  9229,  8846,  4551,  9589, 11664,  7630,  8821,
	 5680,  4956,  6251,  8388, 10156,  8723,  2341,  3159,
	 1467,  5460,  8553,  7783,  2649,  2320,  9036,  6188,
	  737,  3698,  4699,  5753,  9046,  3687,    16,   914,
	 5186, 10531,  4552,  1964,  3509,  8436,  7516,  5381,
	10733,  3281,  7037,  1060,  2895,  7156,  8887,  5357,
	 6409,  8197,  2962,  6375,  5064,  6634,  5625,   278,
	  932, 10229,  8927,  7642,   351,  9298,   237,  5858,
	 7692,  3146, 12126,  7586,  2053, 11285,  3802,  5204,
	 4602,  1748, 11300,   340,  3711,  4614,   300, 10993,
	 5070, 10049, 11616, 12247,  7421, 10707,  5746,  5654,
	 3835,  5553,  1224,  8476,  9237,  3845,   250, 11209,
	 4225,  6326,  9680, 12254,  4136,  2778,   692,  8808,
	 6410,  6718, 10105, 10418,  3759,  7356, 11361,  8433,
	 6437,  3652,  6342,  8978,  5391,  2272,  6476,  7416,
	 8418, 10824, 11986,  5733,   876,  7030,  2167,  2436,
	 3442,  9217,  8206,  4858,  5964,  2746,  7178,  1434,
	 7389,  8879, 10661, 11457,  4220,  1432, 10832,  4328,
	 8557,  1867,  9454,  2416,  3816,  9076,   686,  5393,
	 2523,  4339,  6115,   619,   937,  2834,  7775,  3279,
	 2363,  7488,  6112,  5056,   824, 10204, 11690,  1113,
	 2727,  9848,   896,  2028,  5075,  2654, 10464,  7884,
	12169,  5434,  3070,  6400,  9132, 11672, 12153,  4520,
	 1273,  9739, 11468,  9937, 10039,  9720,  2262,  9399,
	11192,   315,  4511,  1158,  6061,  6751, 11865,   357,
	 7367,  4550,   983,  8534,  8352, 10126,  7530,  9253,
	 4367,  5221,  3999,  8777,  3161,  6990,  4130, 11652,
	 3374, 11477,  1753,   292,  8681,  2806, 10378, 12188,
	 5800, 11811,  3181,  1988,  1024,  9340,  2477, 10928,
	 4582,  6750,  3619,  5503,  5233,  2463,  8470,  7650,
	 7964,  6395,  1071,  1272,  3474, 11045,  3291, 11344,
	 8502,  9478,  9837,  1253,  1857,  6233,  4720, 11561,
	 6034,  9817,  3339,  1797,  2879,  6242,  5200,  2114,
	 7962,  9353, 11363,  5475,  6084,  9601,  4108,  7323,
	10438,  9471,  1271,   408,  6911,  3079,   360,  8276,
	11535,  9156,  9049, 11539,   850,  8617,   784,  7919,
	 8334, 12170,  1846, 10213, 12184,  7827, 11903,  5600,
	 9779,  1012,   721,  2784,  6676,  6552,  5348,  4424,
	 6816,  8405,  9959,  5150,  2356,  5552,  5267,  1333,
	 8801,  9661,  7308,  5788,  4910,   909, 11613,  4395,
	 8238,  6686,  4302,  3044,  2285, 12249,  1963,  9216,
	 4296, 11918,   695,  4371,  9793,  4884,  2411, 10230,
	 2650,   841,  3890, 10231,  7248,  8505, 11196,  6688,
	 4059,  6060,  3686,  4722, 11853,  5816,  7058,  6868,
	11137,  7926,  4894, 12284,  4102,  3908,  3610,  6525,
	 7938,  7982, 11977,  6755,   537,  4562,  1623,  8227,
	11453,  7544,   906, 11816,  9548, 10858,  9703,  2815,
	11736,  6813,  6979,   819,  8903,  6271, 10843,   348,
	 7514,  8339,  6439,   694,   852,  5659,  2781,  3716,
	11589,  3024,  1523,  8659,  4114, 10738,  3303,  5885,
	 2978,  7289, 11884,  9123,  9323, 11830,    98,  2526,
	 2116,  4131, 11407,  1844,  3645,  3916,  8133,  2224,
	10871,  8092,  9651,  5989,  7140,  8480,  1670,   159,
	10923,  4918,   128,  7312,   725,  9157,  5006,  6393,
	 3494,  6043, 10972,  6181, 11838,  3423, 10514,  7668,
	 3693,  6658,  6905, 11953, 10212, 11922,  9101,  8365,
	 5110,    45,  2400,  1921,  4377,  2720,  1695,    51,
	 2808,   650,  1896,  9997,  9971, 11980,  8098,  4833,
	 4135,  4257,  5838,  4765, 10985, 11532,   590, 12198,
	  482, 12173,  2006,  7064, 10018,  3912, 12016, 10519,
	11362,  6954,  2210,   284,  5413,  6601,  3865, 10339,
	11188,  6231,   517,  9564, 11281,  3863,  1210,  4604,
	 8160, 11447,   153,  7204,  5763,  5089,  9248, 12154,
	11748,  1354,  6672,   179,  5532,  2646,  5941, 12185,
	  862,  3158,   477,  7279,  5678,  7914,  4254,   302,
	 2893, 10114,  6890,  9560,  9647, 11905,  4098,  9824,
	10269,  1353, 10715,  5325,  6254,  3951,  1807,  6449,
	 5159,  1308,  8315,  3404,  1877,  1231,   112,  6398,
	11724, 12272,  7286,  1459, 12274,  9896,  3456,   800,
	 1397, 10678,   103,  7420,  7976,   936,   764,   632,
	 7996,  8223,  8445,  7758, 10870,  9571,  2508,  1946,
	 6524, 10158,  1044,  4338,  2457,  3641,  1659,  4139,
	 4688,  9733, 11148,  3946,  2082,  5261,  2036, 11850,
	 7636, 12236,  5366,  2380,  1399,  7720,  2100,  3217,
	10912,  8898,  7578, 11995,  2791,  1215,  3355,  2711,
	 2267,  2004,  8568, 10176,  3214,  2337,  1750,  4729,
	 4997,  7415,  6315, 12044,  4374,  7157,  4844,   211,
	 8003, 10159,  9290, 11481,  1735,  2336,  5793,  9875,
	 8192,   986,  7527,  1401,   870,  3615,  8465,  2756,
	 9770,  2034, 10168,  3264,  6132,    54,  2880,  4763,
	11805,  3074,  8286,  9428,  4881,  6933,  1090, 10038,
	 2567,   708,   893,  6465,  4962, 10024,  2090,  5718,
	10743,   780,  4733,  4623,  2134,  2087,  4802,   884,
	 5372,  5795,  5938,  4333,  6559,  7549,  5269, 10664,
	 4252,  3260,  5917, 10814,  5768,  9983,  8096,  7791,
	 6800,  7491,  6272,  1907, 10947,  6289, 11803,  6032,
	11449,  1171,  9201,  7933,  2479,  7970, 11337,  7062,
	 8911,  6728,  6542,  8114,  8828,  6595,  3545,  4348,
	 4610,  2205,  6999,  8106,  5560, 10390,  9321,  2499,
	 2413,  7272,  6881, 10582,  9308,  9437,  3554,  3326,
	 5991, 11969,  3415, 12283,  9838, 12063,  4332,  7830,
	11329,  6605, 12271,  2044, 11611,  7353, 11201, 11582,
	 3733,  8943,  9978,  1627,  7168,  3935,  5050,  2762,
	 7496, 10383,   755,  1654, 12053,  4952, 10134,  4394,
	 6592,  7898,  7497,  8904, 12029,  3581, 10748,  5674,
	10358,  4901,  7414,  8771,   710,  6764,  8462,  7193,
	 5371,  7274, 11084,   290,  7864,  6827, 11822,  2509,
	 6578,  4026,  5807,  1458,  5721,  5762,  4178,  2105,
	11621,  4852,  8897,  2856, 11510,  9264,  2520,  8776,
	 7011,  2647,  1898,  7039,  5950, 11163,  5488,  6277,
	 9182, 11456,   633, 10046, 11554,  5633,  9587,  2333,
	 7008,  7084,  5047,  7199,  9865,  8997,   569,  6390,
	10845,  9679,  8268, 11472,  4203,  1997,     2,  9331,
	  162,  6182,  2000,  3649,  9792,  6363,  7557,  6187,
	 8510,  9935,  5536,  9019,  3706, 12009,  1452,  3067,
	 5494,  9692,  4865,  6019,  7106,  9610,  4588, 10165,
	 6261,  5887,  2652, 10172,  1580, 10379,  4638,  9949
};

/*
 * Table for inverse NTT, binary case:
 *   iGMb[x] = R*((1/g)^rev(x)) mod q
 * Since g = 7, 1/g = 8778 mod 12289.
 */
static const uint16_t iGMb[] = {
	 4091,  4401,  1081,  1229,  2530,  6014,  7947,  5329,
	 2579,  4751,  6464, 11703,  7023,  2812,  5890, 10698,
	 3109,  2125,  1960, 10925, 10601, 10404,  4189,  1875,
	 5847,  8546,  4615,  5190, 11324, 10578,  5882, 11155,
	 8417, 12275, 10599,  7446,  5719,  3569,  5981, 10108,
	 4426,  8306, 10755,  4679, 11052,  1538, 11857,   100,
	 8247,  6625,  9725,  5145,  3412,  7858,  5831,  9460,
	 5217, 10740,  7882,  7506, 12172, 11292,  6049,    79,
	   13,  6938,  8886,  5453,  4586, 11455,  2903,  4676,
	 9843,  7621,  8822,  9109,  2083,  8507,  8685,  3110,
	 7015,  3269,  1367,  6397, 10259,  8435, 10527, 11559,
	11094,  2211,  1808,  7319,    48,  9547,  2560,  1228,
	 9438, 10787, 11800,  1820, 11406,  8966,  6159,  3012,
	 6109,  2796,  2203,  1652,   711,  7004,  1053,  8973,
	 5244,  1517,  9322, 11269,   900,  3888, 11133, 10736,
	 4949,  7616,  9974,  4746, 10270,   126,  2921,  6720,
	 6635,  6543,  1582,  4868,    42,   673,  2240,  7219,
	 1296, 11989,  7675,  8578, 11949,   989, 10541,  7687,
	 7085,  8487,  1004, 10236,  4703,   163,  9143,  4597,
	 6431, 12052,  2991, 11938,  4647,  3362,  2060, 11357,
	12011,  6664,  5655,  7225,  5914,  9327,  4092,  5880,
	 6932,  3402,  5133,  9394, 11229,  5252,  9008,  1556,
	 6908,  4773,  3853,  8780, 10325,  7737,  1758,  7103,
	11375, 12273,  8602,  3243,  6536,  7590,  8591, 11552,
	 6101,  3253,  9969,  9640,  4506,  3736,  6829, 10822,
	 9130,  9948,  3566,  2133,  3901,  6038,  7333,  6609,
	 3468,  4659,   625,  2700,  7738,  3443,  3060,  3388,
	 3526,  4418, 11911,  6232,  1730,  2558, 10340,  5344,
	 5286,  2190, 11562,  6199,  2482,  8756,  5387,  4101,
	 4609,  8605,  8226,   144,  5656,  8704,  2621,  5424,
	10812,  2959, 11346,  6249,  1715,  4951,  9540,  1888,
	 3764,    39,  8219,  2080,  2502,  1469, 10550,  8709,
	 5601,  1093,  3784,  5041,  2058,  8399, 11448,  9639,
	 2059,  9878,  7405,  2496,  7918, 11594,   371,  7993,
	 3073, 10326,    40, 10004,  9245,  7987,  5603,  4051,
	 7894,   676, 11380,  7379,  6501,  4981,  2628,  3488,
	10956,  7022,  6737,  9933,  7139,  2330,  3884,  5473,
	 7865,  6941,  5737,  5613,  9505, 11568, 11277,  2510,
	 6689,   386,  4462,   105,  2076, 10443,   119,  3955,
	 4370, 11505,  3672, 11439,   750,  3240,  3133,   754,
	 4013, 11929,  9210,  5378, 11881, 11018,  2818,  1851,
	 4966,  8181,  2688,  6205,  6814,   926,  2936,  4327,
	10175,  7089,  6047,  9410, 10492,  8950,  2472,  6255,
	  728,  7569,  6056, 10432, 11036,  2452,  2811,  3787,
	  945,  8998,  1244,  8815, 11017, 11218,  5894,  4325,
	 4639,  3819,  9826,  7056,  6786,  8670,  5539,  7707,
	 1361,  9812,  2949, 11265, 10301,  9108,   478,  6489,
	  101,  1911,  9483,  3608, 11997, 10536,   812,  8915,
	  637,  8159,  5299,  9128,  3512,  8290,  7068,  7922,
	 3036,  4759,  2163,  3937,  3755, 11306,  7739,  4922,
	11932,   424,  5538,  6228, 11131,  7778, 11974,  1097,
	 2890, 10027,  2569,  2250,  2352,   821,  2550, 11016,
	 7769,   136,   617,  3157,  5889,  9219,  6855,   120,
	 4405,  1825,  9635,  7214, 10261, 11393,  2441,  9562,
	11176,   599,  2085, 11465,  7233,  6177,  4801,  9926,
	 9010,  4514,  9455, 11352, 11670,  6174,  7950,  9766,
	 6896, 11603,  3213,  8473,  9873,  2835, 10422,  3732,
	 7961,  1457, 10857,  8069,   832,  1628,  3410,  4900,
	10855,  5111,  9543,  6325,  7431,  4083,  3072,  8847,
	 9853, 10122,  5259, 11413,  6556,   303,  1465,  3871,
	 4873,  5813, 10017,  6898,  3311,  5947,  8637,  5852,
	 3856,   928,  4933,  8530,  1871,  2184,  5571,  5879,
	 3481, 11597,  9511,  8153,    35,  2609,  5963,  8064,
	 1080, 12039,  8444,  3052,  3813, 11065,  6736,  8454,
	 2340,  7651,  1910, 10709,  2117,  9637,  6402,  6028,
	 2124,  7701,  2679,  5183,  6270,  7424,  2597,  6795,
	 9222, 10837,   280,  8583,  3270,  6753,  2354,  3779,
	 6102,  4732,  5926,  2497,  8640, 10289,  6107, 12127,
	 2958, 12287, 10292,  8086,   817,  4021,  2610,  1444,
	 5899, 11720,  3292,  2424,  5090,  7242,  5205,  5281,
	 9956,  2702,  6656,   735,  2243, 11656,   833,  3107,
	 6012,  6801,  1126,  6339,  5250, 10391,  9642,  5278,
	 3513,  9769,  3025,   779,  9433,  3392,  7437,   668,
	10184,  8111,  6527,  6568, 10831,  6482,  8263,  5711,
	 9780,   467,  5462,  4425, 11999,  1205,  5015,  6918,
	 5096,  3827,  5525, 11579,  3518,  4875,  7388,  1931,
	 6615,  1541,  8708,   260,  3385,  4792,  4391,  5697,
	 7895,  2155,  7337,   236, 10635, 11534,  1906,  4793,
	 9527,  7239,  8354,  5121, 10662,  2311,  3346,  8556,
	  707,  1088,  4936,   678, 10245,    18,  5684,   960,
	 4459,  7957,   226,  2451,     6,  8874,   320,  6298,
	 8963,  8735,  2852,  2981,  1707,  5408,  5017,  9876,
	 9790,  2968,  1899,  6729,  4183,  5290, 10084,  7679,
	 7941,  8744,  5694,  3461,  4175,  5747,  5561,  3378,
	 5227,   952,  4319,  9810,  4356,  3088, 11118,   840,
	 6257,   486,  6000,  1342, 10382,  6017,  4798,  5489,
	 4498,  4193,  2306,  6521,  1475,  6372,  9029,  8037,
	 1625,  7020,  4740,  5730,  7956,  6351,  6494,  6917,
	11405,  7487, 10202, 10155,  7666,  7556, 11509,  1546,
	 6571, 10199,  2265,  7327,  5824, 11396, 11581,  9722,
	 2251, 11199,  5356,  7408,  2861,  4003,  9215,   484,
	 7526,  9409, 12235,  6157,  9025,  2121, 10255,  2519,
	 9533,  3824,  8674, 11419, 10888,  4762, 11303,  4097,
	 2414,  6496,  9953, 10554,   808,  2999,  2130,  4286,
	12078,  7445,  5132,  7915,   245,  5974,  4874,  7292,
	 7560, 10539,  9952,  9075,  2113,  3721, 10285, 10022,
	 9578,  8934, 11074,  9498,   294,  4711,  3391,  1377,
	 9072, 10189,  4569, 10890,  9909,  6923,    53,  4653,
	  439, 10253,  7028, 10207,  8343,  1141,  2556,  7601,
	 8150, 10630,  8648,  9832,  7951, 11245,  2131,  5765,
	10343,  9781,  2718,  1419,  4531,  3844,  4066,  4293,
	11657, 11525, 11353,  4313,  4869, 12186,  1611, 10892,
	11489,  8833,  2393,    15, 10830,  5003,    17,   565,
	 5891, 12177, 11058, 10412,  8885,  3974, 10981,  7130,
	 5840, 10482,  8338,  6035,  6964,  1574, 10936,  2020,
	 2465,  8191,   384,  2642,  2729,  5399,  2175,  9396,
	11987,  8035,  4375,  6611,  5010, 11812,  9131, 11427,
	  104,  6348,  9643,  6757, 12110,  5617, 10935,   541,
	  135,  3041,  7200,  6526,  5085, 12136,   842,  4129,
	 7685, 11079,  8426,  1008,  2725, 11772,  6058,  1101,
	 1950,  8424,  5688,  6876, 12005, 10079,  5335,   927,
	 1770,   273,  8377,  2271,  5225, 10283,   116, 11807,
	   91, 11699,   757,  1304,  7524,  6451,  8032,  8154,
	 7456,  4191,   309,  2318,  2292, 10393, 11639,  9481,
	12238, 10594,  9569,  7912, 10368,  9889, 12244,  7179,
	 3924,  3188,   367,  2077,   336,  5384,  5631,  8596,
	 4621,  1775,  8866,   451,  6108,  1317,  6246,  8795,
	 5896,  7283,  3132, 11564,  4977, 12161,  7371,  1366,
	12130, 10619,  3809,  5149,  6300,  2638,  4197,  1418,
	10065,  4156,  8373,  8644, 10445,   882,  8158, 10173,
	 9763, 12191,   459,  2966,  3166,   405,  5000,  9311,
	 6404,  8986,  1551,  8175,  3630, 10766,  9265,   700,
	 8573,  9508,  6630, 11437, 11595,  5850,  3950,  4775,
	11941,  1446,  6018,  3386, 11470,  5310,  5476,   553,
	 9474,  2586,  1431,  2741,   473, 11383,  4745,   836,
	 4062, 10666,  7727, 11752,  5534,   312,  4307,  4351,
	 5764,  8679,  8381,  8187,     5,  7395,  4363,  1152,
	 5421,  5231,  6473,   436,  7567,  8603,  6229,  8230
};


static const int64_t GMb_large[] = {
	4091, -3861059136, -3106990641, 12481398904, 501488012, 4003128018, -11412109157, 
    -2411299632, 5844529679, 668377793, -4428377524, 12090600915, -1268125195, 9618276534,
    4473588232, 6343973965, 5642171362, -5167307718, 2328011538, -12432120276, -9561582164,
    -10474579309, 10895660361, 2825765163, -10583128156, -1023433669, 9106712087, 8590279753,
    10767431656, 698452928, -11228212996, 3384441399, 505125739, -4896793490, 4802993399, 
    2314024847, -7077758941, 9413040168, -3928413182, -1026634761, -3645129789, 2505375940, 
    -5667141887, 8229603674, -7678099502, 9524697477, 9868624990, 6180251057, 12262765420, 
    9390931450, -4086737930, -3403219720, -5236777467, 12560918903, -10702501679, -5028764268, 
    10808053948, -10684786144, -466017853, 8464151945, 10192711040, 8328310138, 11863971290, 
    11341988719, 10698899002, -7641688662, -9487347431, -10474578761, 6041132571, 1078407980, 
    -3030961741, 7170364445, 977109225, -1245905577, -10795888214, -7754538395, 9965652751, 
    8145119383, 10180269063, -2111533062, 5911233701, 3761242310, -3775359855, 7968816934, 
    -1951460974, 735240297, -352058128, 1491402518, 7330875106, 862153100, -6002860010, 
    8172379722, 11327065947, 883830389, 1458950942, 9685026809, 193104606, 3346049048, 
    -1041090493, 7448813556, 612627434, 7568065484, 3594290116, -9548402360, 11302912099, 
    4034513136, -2557608432, -8767409643, -8889278739, -4422914500, -6374794026, 4838657416, 
    6617273592, -7248112604, 9065231921, 6316758059, 9871367844, 9427071965, 10121573697, 
    7723640660, 9709759306, -4619555476, 9090825864, 620148854, 1556258182, -11194351173, 
    10736617656, -1908931434, 9822491, -6158527345, -12411237199, 6148000216, 5776841135, 
    6529658530, 1410717686, -2820276076, 1057602158, -113214846, -9655203399, -768357039, 
    370859166, 10830060482, 8675699911, 9282616210, 4821554823, -9998557480, 7528784155, 
    -2390480962, 6400791080, -8126744437, -1243301269, 3083603754, 1800223198, -7669945546, 
    2754155123, -4867720399, -11334025847, 5667673058, -1549272067, 8185863731, 1626121773, 
    9577567607, -11455465828, 8532652681, 11510144202, 795450956, 6450367280, 12002371700, 
    6915529194, -4500941769, -12141660455, -11305824914, 11225307921, -1351934831, 12857643501, 
    347853356, 12352202724, 12359832293, 2081177774, 7905683020, 6408428791, -11425483964, 
    -6702802110, 11712250262, -6423254013, -7601532352, 582408438, 4669385833, 3105999186, 
    11461821171, -9078974095, 10150037144, 8447039025, -12479089415, 2817014141, -8583531986, 
    -5071880263, -7338083808, -12774749233, -12822418803, -444550793, 2601921738, -455839557, 
    34033087, 7373097512, -5952207593, -5414144604, -930137666, 6595136312, -8733899482, 
    -2264564919, -9727972690, 10380751799, -10436194016, -4540131936, 10939636409, 6389411909, 
    -640733537, -1453725952, 9738043776, 9342667097, 4390035708, -8188390110, 8208621956, 
    12672592891, 10863763764, -4284456390, 8027444730, -7979755258, -1164037465, 3870573242, 
    6504432241, -7330837481, -4095561908, -6470173392, -5633633743, 12543365913, 1009525765, 
    6748685703, -6785180583, 989865255, 10509622418, -12731115832, 4716160651, 7256729096, 
    -10518903089, -12098306596, 12559907890, 5781686028, 9086658361, 1292774871, -12265300513, 
    1346365549, 9353705854, -3186368717, 1465826578, 200459, -8803271218, -10508620630, 
    -2591755261, 11688010699, -7141889903, 6310547291, -2760672637, 2914112713, -3040926371, 
    -810609915, -4703133637, -3440094532, -7284464977, 12326747789, -1577388511, 5883457069, 
    -8384942291, -7618196974, -5468675480, 1065587303, 2595248939, -8446011615, -2968932206, 
    2549441251, 1844917295, -5910163818, 10340999255, 7779963556, -541459914, -1678656458, 
    10545688112, 11866259322, 6301911101, 10576678648, -905009341, 6808828684, 11458824400, 
    -7331247980, -1362989797, 7503932575, -6325831767, -12356255297, 12076201590, 2672953771, 
    2922823144, -1281580207, 4767870063, -6146539423, 2454758132, -8063198912, -1660339696, 
    -1822934157, -10392884532, -5300950889, 6416000316, -10788815940, -874002419, -9863810619, 
    1421437685, -12074410430, -11168895835, -7353498314, -7604476589, 8849975538, -780589657, 
    -1023556115, 12163350721, 12547654421, 11323952458, 3238344009, -25561660, 9223646358, 
    6238448612, -10739154941, -5042791402, 7280666701, 10293686457, -2429220371, -8639435616, 
    6182609791, -6109387706, -6035793581, 7648809540, -12585400145, 3120709943, -10467969526, 
    -211928194, -8722498340, 2181135735, -11047766742, -8354002909, -4584711467, -7879194578, 
    8864955532, -12292002421, 9462125694, 5042591569, -8063804831, -3277032525, 12838918718, 
    3233041592, 1244995945, 1440824040, -5934668255, -7704939031, -636828112, -6151502768, 
    10668961666, -3085366847, -4719992020, -12412641421, 2123858783, 1324746181, -5343656223, 
    3887163802, -8792449409, 12075224789, -6716402157, -1247397668, -3826365882, -6194621592, 
    5769786796, 12581534939, -11962083883, -3081014947, -9150431970, -5804695033, 481302059, 
    -5415096458, -2560233968, 10625912472, 12482275946, -6464268370, -6752653956, 7622101588, 
    282898186, 10200686875, 7931351547, 411984501, 992249040, 7280181084, -10296853152, -8144853266, 
    4327952325, 8286868036, 9564716466, 11024171885, 2969571821, 481084338, 1563512495, -3744572542, 
    9469979605, 4252727774, 12755350144, 419381030, -12170159218, 7307265136, -10857438756, 
    -1896783508, 2370555543, 8307612178, 1322757972, -5383242459, 7083127689, -6669278148, 
    11145734450, -5571982163, 990324410, 5822119217, 4942955108, -6067850564, 12071117138, 
    -5411988483, 5921243057, 4712804012, 5394190028, -10958382577, -7995884947, 9005619309, 
    11800789525, -2168822068, -3047972995, -8324066034, 6275390582, -2864531984, -7217887284, 
    4393953591, -2998458339, -12022811080, 9989939537, -4457071147, 1588051777, -4453336332, 
    -3700248325, 11029088814, -5140632761, 5241371711, -12655497499, 3148498285, 2555179156, 
    -3051273652, 9718814945, 1445570323, -2770423697, 5494013341, -1054824217, 4125107305, 
    -392524157, 533005366, -4675935024, 1672516936, -6794956481, 9338152872, 4576621408, 
    -12114640442, -5395786756, -1371661583, -5310813558, 6533925892, -1088879404, -9693821508, 
    2972547568, -6623857178, 1050104767, -9844126370, -6298067781, 8639777890, 6936641081, 
    -7127620105, 830804651, 10666263181, 3780202487, 1353722037, -2698896614, -11717076393, 
    -3790346495, 9338858520, -12275843987, -7177035474, 6358472368, 4444491883, -1154143747, 
    -12433285392, -2862393587, 6086376092, -11335688256, -6533828665, 8010035587, -9248816419, 
    9370939437, 9644202132, -1930502109, 11350025523, 1113111867, -2214513996, 28637, 
    -1257610174, -8864032598, -7119485464, 3510416084, -4906192843, 3151251660, -9311412021, 
    2257002086, -2479640640, 1929421755, -12737988822, -6013543470, -2943325783, -10680084451, 
    9401422069, 840493867, 5346864081, -10905379232, -6423112951, -2506565703, 11145641362, 
    -6766393232, -4967195720, -9657387647, 12879151397, -6404129261, -3270299257, 6652523032, 
    4006646679, 2397627043, -1271731762, 3535880173, 5808807457, 6419489704, 4740023943, 
    -9457946609, 2903332268, -5181285319, 11295162346, 1685555566, 7520946448, 5554105084, 
    -362569529, 11235007742, 2497484320, 7449798252, -2142018870, -5786611503, 11762601270, 
    10392742248, -3055186153, 3373221001, -3801671258, -9783380214, 7417043957, 3424219905, 
    11374232949, -4760146097, 7911616408, 11601215374, 6532797191, 11996337452, 1768655631, 
    10467783569, -1952213078, -1986922572, 11145645198, 3633222330, -2472737680, 11711344509, 
    -2928249395, 6839764575, -8721339039, 6033158405, -1599773914, 1040095243, -4256096490, 
    -12413844102, -4956230312, 2723930240, -6599392799, 6500545438, 11380787087, -10796893923, 
    -12153315666, 9943315116, 10800718368, -10245050808, -8401617696, 4747430767, 12173780875, 
    1735628332, -8038833354, -2758650785, -7382823420, 1351732242, -12369053982, -1561016753, 
    -1981752540, 11446677229, 5452346928, 8873681772, -4830459149, 8969258550, -6397621710, 
    5896741550, 3200732933, -4178606728, 5052261584, -7495539928, 9606906478, 7666209477, 
    -7787117992, -5262866931, -7337010003, 7538390176, -3717920594, 2141706117, -4192584181, 
    6407130410, 2466558651, -778564145, 11649865826, -4670144731, 4781429830, -9378494829, 
    1673473652, 68757437, -4454985748, -9569249059, 1517987496, 1783182278, -1537033277, 
    12738328060, -7151203885, 7403215106, -792503922, 1133050221, -5667768198, 11185951482, 
    1653593405, 11413925205, 1947709104, 7981079983, 11614473543, -5996411844, 5584778120, 
    -1007432843, 5691337637, 9228137046, 1347433728, -7441604239, 6025621525, -12709475, 
    9119823541, 9720172451, 8242260502, -11265024248, 9360613766, 11382852411, 9776736722, 
    -8605490706, -420577013, -8191627134, -2712906708, -7950678784, 5921786054, -1699226523, 
    7456991295, 2207412085, 2845101782, 2399255207, 10828276455, 11916062452, -656610992, 
    6292699385, 9069674344, -2164879695, 1716924069, 867737222, -11784440368, -4702833324, 
    4571159071, 11122596135, -10656693596, 3495923103, -9256182319, 1104343225, -6658856897, 5806927579, 2320438890, 7589665619, 4272343538, 2539228438, -7258096634, 7446512486, -3977307161, 5462038107, -1499762744, 1183113109, -8843371324, -9953157144, 8891418201, 10260821693, -12372929934, 7511374395, -4382950402, -6805309592, -7737027391, -4053490309, 3512477385, 1026757067, -734304466, -9413763428, 8565595367, 2558477615, -3378337946, 7120155528, -3572762935, 3310629020, 702560307, 8958030449, 4314777600, 9967082683, -6560684659, 418792072, -10356835108, -8669358800, 5048805936, 2714083213, -3740359198, -425638361, -7943058535, -6022600325, 2329819173, 7716920119, -12124859312, 7313905525, -11002811627, 3438837325, -10326194297, -1886422804, 8509184885, -12724059304, -10820673601, 2425042358, -3198694493, -4324330719, 3677390102, 10462044640, 8649129943, -1566805223, 4886662893, 42485865, 10231656187, 1403213, -10083290970, -9135834965, -10984005727, 4506663559, 5841342804, -1639168003, -8459813365, 7513887102, 8778283750, -4242625458, -6019548929, 10279091647, 7865979185, -3846111593, 5348309712, 2529493816, 7161569628, 2507197398, 10540207355, -9720759428, 8000512525, -6546818384, -6244843815, 666218208, 5611503457, 9772464066, 4751554929, -110332320, -12755195018, -8535477295, 1777487935, 5754403920, -3131265280, 2453951809, -10784475098, 3280482514, 1625140206, 2302367133, -5346930864, -6170348358, 4978919005, -8189309891, 8016335387, -106642007, -7961180504, -9828339050, 3077404169, -8666034863, 292709391, -4110799482, -341707127, -6699591605, 9040427698, -8232875675, 7636785991, -1474226863, 3298302711, 11727568927, 8734440298, -1487277439, 11709699921, -10770517908, -9985289983, 10410221210, -5464127599, -5733236585, 11700007166, 9092513393, -11929301121, -9914470633, 1692520708, 11594260730, -10304778596, -8972716831, 3650329544, -3493951706, 11679485588, -2374383704, -8352825730, 4623562870, -1247699926, -732553324, 3703383465, 9254809672, 9982323720, -2962157269, 202170146, 10525318529, -889660305, -2725765030, 1052425609, -5470289394, 2994692877, -7255857724, -9680146123, 1810370413, -493256335, -10633655232, -7340545989, -8911811335, -6854939353, -4017628075, -12606948233, -1456307716, 3770473060, -8153667717, 1794938329, -4431317471, -175270661, -11847239637, -3738935383, 1982109592, -748370273, 11270693373, 7157163173, 2877375855, -7229323568, 8088738787, 3246591134, 11870156766, -4837573125, -6155505616, -10053548955, 5100869456, 10475657871, 8830981876, -5620676358, 3369114413, -12135871428, -5036735887, 8525221639, 10066520288, 10584693535, -7182228078, 5810998752, 1980287302, -11631232180, -8905069071, -2148964462, -7370794374, 3451856806, -12821624284, 2680240492, 4525862497, -2121468624, 5391810075, 5292235317, 5038796600, -4928173712, 9716003571, -1347759471, -2429612688, 1859152558, -7516860716, 9633089189, -12772484718, 2113996370, 9559752198, -9008175555, 3708986912, 12340298479, -12215537496, 5975450794, 5200571458, 6006848267, -6985681904, -6771017192, 1205654172, -5337624812, -11750447995, -10546069693, 7968520641, -11608485229, -215150756, -7084548684, -2327031691, 5324707162, -6949681058, 1932639035, 10967021149, 5597695705, 1031361432, -10446132381, 1760328326, -3196716837, 3994063378, -10357688937, 5685424335, 9668017975, 12454461892, -10036234373, 11116362439, 11776315912, -10153536219, 597783818, -4487988396, 4778872881, 9515503574, 1247658725, -2156912533, -1730037104, 10085203612, -8248338410, 6672534276, -7718924924, -2422499237, -637995485, -7042633668, -3137966431, -443122982, 12118489886, -8575675268, 10566939187, 9807092759, -914533412, -8104361304, 3526206874, -8936137329, -4816841221, -10282100912, 7805561863, 11875301110, 12668003151, -9829133089, -8490070789, 1086837335, 9479640747, 11667764825, 12143364623, 12574886658, 5555376870, 6019624334, 4865076537, -8908875056, -2131840275, 1000961505, -7140788223, 10584355537, 7016821656, 2457770111, 5762722862, 9353195622, -12188769961, 7527117303, 10333880304, 2242827776, 10350671781, -8079207287, 6699366396, -7501055042, 5211786858, -8711815841, -10293900495, 6816385532, -12153982578, 4091, -3861059136, -3106990641, 12481398904, 501488012, 4003128018, -11412109157, -2411299632, 5844529679, 668377793, -4428377524, 12090600915, -1268125195, 9618276534, 4473588232, 6343973965, 5642171362, -5167307718, 2328011538, -12432120276, -9561582164, -10474579309, 10895660361, 2825765163, -10583128156, -1023433669, 9106712087, 8590279753, 10767431656, 698452928, -11228212996, 3384441399, 505125739, -4896793490, 4802993399, 2314024847, -7077758941, 9413040168, -3928413182, -1026634761, -3645129789, 2505375940, -5667141887, 8229603674, -7678099502, 9524697477, 9868624990, 6180251057, 12262765420, 9390931450, -4086737930, -3403219720, -5236777467, 12560918903, -10702501679, -5028764268, 10808053948, -10684786144, -466017853, 8464151945, 10192711040, 8328310138, 11863971290, 11341988719, 10698899002, -7641688662, -9487347431, -10474578761, 6041132571, 1078407980, -3030961741, 7170364445, 977109225, -1245905577, -10795888214, -7754538395, 9965652751, 8145119383, 10180269063, -2111533062, 5911233701, 3761242310, -3775359855, 7968816934, -1951460974, 735240297, -352058128, 1491402518, 7330875106, 862153100, -6002860010, 8172379722, 11327065947, 883830389, 1458950942, 9685026809, 193104606, 3346049048, -1041090493, 7448813556, 612627434, 7568065484, 3594290116, -9548402360, 11302912099, 4034513136, -2557608432, -8767409643, -8889278739, -4422914500, -6374794026, 4838657416, 6617273592, -7248112604, 9065231921, 6316758059, 9871367844, 9427071965, 10121573697, 7723640660, 9709759306, -4619555476, 9090825864, 620148854, 1556258182, -11194351173, 10736617656, -1908931434, 9822491, -6158527345, -12411237199, 6148000216, 5776841135, 6529658530, 1410717686, -2820276076, 1057602158, -113214846, -9655203399, -768357039, 370859166, 10830060482, 8675699911, 9282616210, 4821554823, -9998557480, 7528784155, -2390480962, 6400791080, -8126744437, -1243301269, 3083603754, 1800223198, -7669945546, 2754155123, -4867720399, -11334025847, 5667673058, -1549272067, 8185863731, 1626121773, 9577567607, -11455465828, 8532652681, 11510144202, 795450956, 6450367280, 12002371700, 6915529194, -4500941769, -12141660455, -11305824914, 11225307921, -1351934831, 12857643501, 347853356, 12352202724, 12359832293, 2081177774, 7905683020, 6408428791, -11425483964, -6702802110, 11712250262, -6423254013, -7601532352, 582408438, 4669385833, 3105999186, 11461821171, -9078974095, 10150037144, 8447039025, -12479089415, 2817014141, -8583531986, -5071880263, -7338083808, -12774749233, -12822418803, -444550793, 2601921738, -455839557, 34033087, 7373097512, -5952207593, -5414144604, -930137666, 6595136312, -8733899482, -2264564919, -9727972690, 10380751799, -10436194016, -4540131936, 10939636409, 6389411909, -640733537, -1453725952, 9738043776, 9342667097, 4390035708, -8188390110, 8208621956, 12672592891, 10863763764, -4284456390, 8027444730, -7979755258, -1164037465, 3870573242, 6504432241, -7330837481, -4095561908, -6470173392, -5633633743, 12543365913, 1009525765, 6748685703, -6785180583, 989865255, 10509622418, -12731115832, 4716160651, 7256729096, -10518903089, -12098306596, 12559907890, 5781686028, 9086658361, 1292774871, -12265300513, 1346365549, 9353705854, -3186368717, 1465826578, 200459, -8803271218, -10508620630, -2591755261, 11688010699, -7141889903, 6310547291, -2760672637, 2914112713, -3040926371, -810609915, -4703133637, -3440094532, -7284464977, 12326747789, -1577388511, 5883457069, -8384942291, -7618196974, -5468675480, 1065587303, 2595248939, -8446011615, -2968932206, 2549441251, 1844917295, -5910163818, 10340999255, 7779963556, -541459914, -1678656458, 10545688112, 11866259322, 6301911101, 10576678648, -905009341, 6808828684, 11458824400, -7331247980, -1362989797, 7503932575, -6325831767, -12356255297, 12076201590, 2672953771, 2922823144, -1281580207, 4767870063, -6146539423, 2454758132, -8063198912, -1660339696, -1822934157, -10392884532, -5300950889, 6416000316, -10788815940, -874002419, -9863810619, 1421437685, -12074410430, -11168895835, -7353498314, -7604476589, 8849975538, -780589657, -1023556115, 12163350721, 12547654421, 11323952458, 3238344009, -25561660, 9223646358, 6238448612, -10739154941, -5042791402, 7280666701, 10293686457, -2429220371, -8639435616, 6182609791, -6109387706, -6035793581, 7648809540, -12585400145, 3120709943, -10467969526, -211928194, -8722498340, 2181135735, -11047766742, -8354002909, -4584711467, -7879194578, 8864955532, -12292002421, 9462125694, 5042591569, -8063804831, -3277032525, 12838918718, 3233041592, 1244995945, 1440824040, -5934668255, -7704939031, -636828112, -6151502768, 10668961666, -3085366847, -4719992020, -12412641421, 2123858783, 1324746181, -5343656223, 3887163802, -8792449409, 12075224789, -6716402157, -1247397668, -3826365882, -6194621592, 5769786796, 12581534939, -11962083883, -3081014947, -9150431970, -5804695033, 481302059, -5415096458, -2560233968, 10625912472, 12482275946, -6464268370, -6752653956, 7622101588, 282898186, 10200686875, 7931351547, 411984501, 992249040, 7280181084, -10296853152, -8144853266, 4327952325, 8286868036, 9564716466, 11024171885, 2969571821, 481084338, 1563512495, -3744572542, 9469979605, 4252727774, 12755350144, 419381030, -12170159218, 7307265136, -10857438756, -1896783508, 2370555543, 8307612178, 1322757972, -5383242459, 7083127689, -6669278148, 11145734450, -5571982163, 990324410, 5822119217, 4942955108, -6067850564, 12071117138, -5411988483, 5921243057, 4712804012, 5394190028, -10958382577, -7995884947, 9005619309, 11800789525, -2168822068, -3047972995, -8324066034, 6275390582, -2864531984, -7217887284, 4393953591, -2998458339, -12022811080, 9989939537, -4457071147, 1588051777, -4453336332, -3700248325, 11029088814, -5140632761, 5241371711, -12655497499, 3148498285, 2555179156, -3051273652, 9718814945, 1445570323, -2770423697, 5494013341, -1054824217, 4125107305, -392524157, 533005366, -4675935024, 1672516936, -6794956481, 9338152872, 4576621408, -12114640442, -5395786756, -1371661583, -5310813558, 6533925892, -1088879404, -9693821508, 2972547568, -6623857178, 1050104767, -9844126370, -6298067781, 8639777890, 6936641081, -7127620105, 830804651, 10666263181, 3780202487, 1353722037, -2698896614, -11717076393, -3790346495, 9338858520, -12275843987, -7177035474, 6358472368, 4444491883, -1154143747, -12433285392, -2862393587, 6086376092, -11335688256, -6533828665, 8010035587, -9248816419, 9370939437, 9644202132, -1930502109, 11350025523, 1113111867, -2214513996, 28637, -1257610174, -8864032598, -7119485464, 3510416084, -4906192843, 3151251660, -9311412021, 2257002086, -2479640640, 1929421755, -12737988822, -6013543470, -2943325783, -10680084451, 9401422069, 840493867, 5346864081, -10905379232, -6423112951, -2506565703, 11145641362, -6766393232, -4967195720, -9657387647, 12879151397, -6404129261, -3270299257, 6652523032, 4006646679, 2397627043, -1271731762, 3535880173, 5808807457, 6419489704, 4740023943, -9457946609, 2903332268, -5181285319, 11295162346, 1685555566, 7520946448, 5554105084, -362569529, 11235007742, 2497484320, 7449798252, -2142018870, -5786611503, 11762601270, 10392742248, -3055186153, 3373221001, -3801671258, -9783380214, 7417043957, 3424219905, 11374232949, -4760146097, 7911616408, 11601215374, 6532797191, 11996337452, 1768655631, 10467783569, -1952213078, -1986922572, 11145645198, 3633222330, -2472737680, 11711344509, -2928249395, 6839764575, -8721339039, 6033158405, -1599773914, 1040095243, -4256096490, -12413844102, -4956230312, 2723930240, -6599392799, 6500545438, 11380787087, -10796893923, -12153315666, 9943315116, 10800718368, -10245050808, -8401617696, 4747430767, 12173780875, 1735628332, -8038833354, -2758650785, -7382823420, 1351732242, -12369053982, -1561016753, -1981752540, 11446677229, 5452346928, 8873681772, -4830459149, 8969258550, -6397621710, 5896741550, 3200732933, -4178606728, 5052261584, -7495539928, 9606906478, 7666209477, -7787117992, -5262866931, -7337010003, 7538390176, -3717920594, 2141706117, -4192584181, 6407130410, 2466558651, -778564145, 11649865826, -4670144731, 4781429830, -9378494829, 1673473652, 68757437, -4454985748, -9569249059, 1517987496, 1783182278, -1537033277, 12738328060, -7151203885, 7403215106, -792503922, 1133050221, -5667768198, 11185951482, 1653593405, 11413925205, 1947709104, 7981079983, 11614473543, -5996411844, 5584778120, -1007432843, 5691337637, 9228137046, 1347433728, -7441604239, 6025621525, -12709475, 9119823541, 9720172451, 8242260502, -11265024248, 9360613766, 11382852411, 9776736722, -8605490706, -420577013, -8191627134, -2712906708, -7950678784, 5921786054, -1699226523, 7456991295, 2207412085, 2845101782, 2399255207, 10828276455, 11916062452, -656610992, 6292699385, 9069674344, -2164879695, 1716924069, 867737222, -11784440368, -4702833324, 4571159071, 11122596135, -10656693596, 3495923103, -9256182319, 1104343225, -6658856897, 5806927579, 2320438890, 7589665619, 4272343538, 2539228438, -7258096634, 7446512486, -3977307161, 5462038107, -1499762744, 1183113109, -8843371324, -9953157144, 8891418201, 10260821693, -12372929934, 7511374395, -4382950402, -6805309592, -7737027391, -4053490309, 3512477385, 1026757067, -734304466, -9413763428, 8565595367, 2558477615, -3378337946, 7120155528, -3572762935, 3310629020, 702560307, 8958030449, 4314777600, 9967082683, -6560684659, 418792072, -10356835108, -8669358800, 5048805936, 2714083213, -3740359198, -425638361, -7943058535, -6022600325, 2329819173, 7716920119, -12124859312, 7313905525, -11002811627, 3438837325, -10326194297, -1886422804, 8509184885, -12724059304, -10820673601, 2425042358, -3198694493, -4324330719, 3677390102, 10462044640, 8649129943, -1566805223, 4886662893, 42485865, 10231656187, 1403213, -10083290970, -9135834965, -10984005727, 4506663559, 5841342804, -1639168003, -8459813365, 7513887102, 8778283750, -4242625458, -6019548929, 10279091647, 7865979185, -3846111593, 5348309712, 2529493816, 7161569628, 2507197398, 10540207355, -9720759428, 8000512525, -6546818384, -6244843815, 666218208, 5611503457, 9772464066, 4751554929, -110332320, -12755195018, -8535477295, 1777487935, 5754403920, -3131265280, 2453951809, -10784475098, 3280482514, 1625140206, 2302367133, -5346930864, -6170348358, 4978919005, -8189309891, 8016335387, -106642007, -7961180504, -9828339050, 3077404169, -8666034863, 292709391, -4110799482, -341707127, -6699591605, 9040427698, -8232875675, 7636785991, -1474226863, 3298302711, 11727568927, 8734440298, -1487277439, 11709699921, -10770517908, -9985289983, 10410221210, -5464127599, -5733236585, 11700007166, 9092513393, -11929301121, -9914470633, 1692520708, 11594260730, -10304778596, -8972716831, 3650329544, -3493951706, 11679485588, -2374383704, -8352825730, 4623562870, -1247699926, -732553324, 3703383465, 9254809672, 9982323720, -2962157269, 202170146, 10525318529, -889660305, -2725765030, 1052425609, -5470289394, 2994692877, -7255857724, -9680146123, 1810370413, -493256335, -10633655232, -7340545989, -8911811335, -6854939353, -4017628075, -12606948233, -1456307716, 3770473060, -8153667717, 1794938329, -4431317471, -175270661, -11847239637, -3738935383, 1982109592, -748370273, 11270693373, 7157163173, 2877375855, -7229323568, 8088738787, 3246591134, 11870156766, -4837573125, -6155505616, -10053548955, 5100869456, 10475657871, 8830981876, -5620676358, 3369114413, -12135871428, -5036735887, 8525221639, 10066520288, 10584693535, -7182228078, 5810998752, 1980287302, -11631232180, -8905069071, -2148964462, -7370794374, 3451856806, -12821624284, 2680240492, 4525862497, -2121468624, 5391810075, 5292235317, 5038796600, -4928173712, 9716003571, -1347759471, -2429612688, 1859152558, -7516860716, 9633089189, -12772484718, 2113996370, 9559752198, -9008175555, 3708986912, 12340298479, -12215537496, 5975450794, 5200571458, 6006848267, -6985681904, -6771017192, 1205654172, -5337624812, -11750447995, -10546069693, 7968520641, -11608485229, -215150756, -7084548684, -2327031691, 5324707162, -6949681058, 1932639035, 10967021149, 5597695705, 1031361432, -10446132381, 1760328326, -3196716837, 3994063378, -10357688937, 5685424335, 9668017975, 12454461892, -10036234373, 11116362439, 11776315912, -10153536219, 597783818, -4487988396, 4778872881, 9515503574, 1247658725, -2156912533, -1730037104, 10085203612, -8248338410, 6672534276, -7718924924, -2422499237, -637995485, -7042633668, -3137966431, -443122982, 12118489886, -8575675268, 10566939187, 9807092759, -914533412, -8104361304, 3526206874, -8936137329, -4816841221, -10282100912, 7805561863, 11875301110, 12668003151, -9829133089, -8490070789, 1086837335, 9479640747, 11667764825, 12143364623, 12574886658, 5555376870, 6019624334, 4865076537, -8908875056, -2131840275, 1000961505, -7140788223, 10584355537, 7016821656, 2457770111, 5762722862, 9353195622, -12188769961, 7527117303, 10333880304, 2242827776, 10350671781, -8079207287, 6699366396, -7501055042, 5211786858, -8711815841, -10293900495, 6816385532, -12153982578,
};



static const int64_t iGMb_large[] = {
4091, 11623798206, -12009057336, -11521246879, -11532195828, 5558332314, -6485516940, -4035963124, 5049454126, -8753698664, 8526285717, 
-11148568470, -3950775450, 5940915582, -5500789683, -1075395049, 11850363359, -3800023872, 714363439, -10669305698, 3882726836, 1928615171, 
-6930787845, 7516506347, 10558371683, 9106666491, -7094373675, 9257592730, 8318046888, -6492179389, -3510043041, 11551294522, 5696941888, 
10021836510, -3327753427, 12825686771, 3363136795, -2198954714, 11716154925, 8244453722, 6035335099, 10741191083, -9545658676, -10668006155, 
3856865247, 1583983970, -6517993113, 3422841016, -4239230616, -2114138444, 3738752289, -9168832832, 5560157529, 11872188534, -5003882618, 
-1304033931, 812120144, -3788441159, 12434574006, -5054533082, 5777923629, -10263391212, 1510087552, 1847265892, 5300612767, -1238685200, 
12764374317, -2415956756, 5654379880, 1352029354, -5196729439, -9710174323, -2126570414, -756139120, -1565637429, -3056832249, 12546520645, 
-2703018980, 12649352676, 2537545713, 7658549858, -1453840664, 5958675998, -10018857343, -791998482, -10394233913, 5431293838, -754902461, 
1410170041, 11450842965, -8540321065, -8129800902, -3214822428, -9913671228, 9577287066, 8969857285, 6082538906, 4162182936, -1284444069, 
-5654167457, -5768391770, -4461474926, -2018308245, -714017779, -10747752625, 4448666645, -7574496109, 847850293, 2555879616, -10479189334, 
3602729345, -10066376470, 6695671761, -12684796773, -9322804368, -3645396607, 6481067882, 336629782, -888183440, -3970238585, 506017027, 
-711935126, 9095348463, -12295690482, 4174548224, 10057337142, 4550648640, 10087347874, 6369419490, -3404916335, 4909415456, -3325306888, 
-10522727635, 12220431382, 12054887957, 11025946682, 2185321095, -12029808514, 2359627818, 7444968821, -11062820844, 10690875454, -5034034683, 
-8191445631, 712178656, -2732582508, 10455456303, -4705393564, 4377227586, -9805941875, 7052400633, -10859030913, 1847237437, -3079338329, 
3935534227, 292609229, -7025898748, -29823367, 1178918622, -2426836233, -11763121382, -10471535485, 12253500183, -2565791762, 10998780401, 
7891896993, -6304574122, -6621127470, -7940610222, 10497463484, -9943393867, 8270950675, -8562548112, 5837674176, 2115092382, 1643136265, 
-2647586663, 10083378780, -11670714809, 6404942198, 6236239109, 5132052798, -7103999984, 5218089360, 2521103429, -4605302876, 6174460585, 
-3015697872, 582396926, -12759281529, 11223680823, 3849371188, 3148957652, 6687952584, -11798178073, 11882582483, 8876830687, 2466529383, 
-1706751400, -11429098610, -2178320179, 3167224094, -2636141424, 10455299783, -1241381276, -1107450811, -12376221728, -8222204780, -3850659301, 
-751197671, 2664587655, 7575743804, 10380960805, 4476291101, -6665492878, -10133577485, -3493994270, 7061439755, -1223762767, 4078782693, 
9683844264, -6811098343, 7497658538, -11709139126, -2624709731, 11210167401, -5875584589, -9634295781, -2377196495, 8886834066, -11714625099, 
-1633139561, 9015851091, 12318719192, -10869687564, 6431411947, 686774083, -2127098227, 1947202059, -4118074379, -2046445661, 11855451249, 
6020782700, -6804879079, 1117030384, 3333876974, -6194743223, 8604255267, -10884200831, 9113565931, -11844669093, -7570403934, 2991617154, 
8027902254, -8342048338, 5575716726, 8357363583, -3951691259, 3124489015, 2577250721, -4506411602, -6535923373, 8202006108, -2388105081, 
1039328613, -6521125019, 10108540119, -3608289941, -7364271700, -3637529960, 9926927789, 10667226172, 3314876243, 5169112285, -5605772901, 
-10307275021, 11569691133, -8322364393, 7170014198, 3297316068, 6986583084, -10113445493, 3900067466, -7240385872, 7851581960, -7160450513, 
-6247253814, -7703006654, -1904950233, -5988036366, 6029860678, 4292025790, -4265545972, 12727099424, 5654171211, -10334838835, -4394424640, 
-659458123, 2715894079, 8368031543, 9665092073, 10368593520, -9410127490, -7913180773, 4139553787, -777246293, 4272409154, -231783048, 
2932717837, 8992139348, -2921615757, 10670817549, -3311542439, 961910331, -10537380377, -10958399457, 455005914, 11771639068, -4029133343, 
-4349539820, 6206220491, -8413404262, -859280588, -1534854349, -9904297089, 4379470087, -11201054695, -1915976462, -12092375143, 12198135472, 
-5912742432, 5027982049, 106334144, -12077497396, 5644318463, 3262387754, 6411481924, 5863702863, -12200430921, -7936437893, -8154842342, 
2443828194, -2901535486, 9041332200, 1911073515, 3311253602, -1908682619, 9239324401, 6126991103, -11151724946, 21315928, -1236528296, 769203523, 
3904559410, -3485599092, 3674351166, 8416376190, -11194374776, -947762505, -9547965858, 1839835121, 4601637593, -6638097007, 1644304480, 
302152766, 10370639921, -7746787595, -6558228968, -3035908014, -5869772514, 10321358083, 5077937566, 848354281, 10053470757, 294296552, 
-10350017684, -10181255160, 5599679252, -212148108, 6729339576, -5707936088, -5278173244, 8032999828, -3599624192, 1500709289, -1750062112, 
9512579744, -11804359280, 2510381890, 1043653043, -405241294, -8753640444, 6187912550, -9927416869, 11729374781, 2881632155, 6558096723, 
4835729630, 3613694553, 9556525152, -12762170596, 655917270, -3128421066, 3656349045, 5517725215, -3237321744, 8027049428, 4647457733, 
9432971448, 6062513185, -12389515075, 11550986473, -8226940022, -1169007458, 9901076692, -12634670761, -3233771876, -10986482086, 12597554155, 
8782401819, 7729963827, -2957653712, -4275327058, -521218987, 5767675170, 5491378065, -7824679944, -9610648165, -12549757745, -8212806750, 
-814242663, -11294899239, -11883397976, 6617050077, -2644806779, 1359940107, 2623633575, 6082156154, 10027653217, -1931401951, -1716830077, 
102795059, -9909343781, 9603333847, -3033929395, 2036146807, -4094081182, -6623380532, -9794293675, 164844831, -4567209834, -9112617317, 
-6869481285, -78610123, 3671822323, 10958029409, 725697059, 3515911300, -422408346, -5827368120, -1793915201, 7931489110, 7920204630, 424576661, 
9855957975, -4340471904, 2307419345, 2431406336, 17785448, 7404693519, -11539052692, 11234881056, 2043750336, -9695913446, 6784355666, 5982508958,
 585372715, 9530777892, -11797776292, 4493289692, 2709643103, -11803968033, 2612615834, 12411656199, -11449053798, 10292124805, -11916414440, 
 -9533156287, 6740992700, -6311241520, 11128367694, 6773610944, -8378384210, 1137162573, -11822698486, -2818395262, -10245214872, -9751597475, 
 513099061, -5319262945, -11340733802, 5534957839, -8547005126, -5059736659, -2124202008, 6071587573, -11611872401, -3748883835, 2352586101, 
 313465291, -3338030928, -9349413808, 7867701915, 9164557794, -4047607820, 5431754127, -6841691064, 7996990147, -8664593273, -5083939116, 
 -5052525109, 1999295404, -3093046285, -8477467960, -3882000025, 12758700761, -9752351475, -6797471046, 10021074129, -6750193581, 2933771308, 
 -1858063798, -9147153971, 6422617374, -12486231235, 7614742753, -9518571443, 11337302710, -8142254172, 8936250576, -504605155, -11172362483, 
 11210797717, -6825512035, -9546769018, 12739892444, -1763113658, 19699322, 4084987154, 11487453909, -5322356821, 1142125418, 8866477746, 
 1976898357, -5637896247, 9501709534, -5711275054, 5456436500, -11346464356, -2448025020, -10884811561, 7856954204, 3329443616, 10116134916, 
 -10294628238, 10380332490, -8967591844, -3800852833, -9871417914, -6687579937, 9283940620, -1800664498, -4173944417, 6364911361, -161465680, 
 -10709563668, -3215382051, -1684352269, 5829029507, -5793066269, -1174000388, -4524778728, -8872274550, -3462073254, 9841911146, -9334731800, 
 2964092249, 8099856905, 12643953156, -451674377, -8812306934, 9204919805, 11410568636, 3016704587, -2327753187, 11285887949, 10511774790, 
 4351484635, -1872618508, -1194643887, -8224248807, -12225255664, 11526098915, -6118497731, 3835308058, 1217993792, -12555418391, 745092746, 
 6632943784, -8291864672, 7299017878, 11261563536, 8660282463, 2474140404, 5132569241, -9670716415, 10541357750, 10032592093, 7361887781, 
 -4100440113, -5205593625, -7804633872, 1430066343, 4858298231, -1363429261, 9882692948, 2087362756, -880247930, 10462860379, -6549277337, 
 12508509992, -9958135911, -9095511336, -9447188699, 12832150931, 103850307, 5822862863, 4648923585, -766336902, 2527016644, -10201679239, 
 12825050142, -4080530113, 5518128157, 4299578028, 11242348759, -7425313842, 12071557300, 10714354908, -10853879050, 10396121375, 4404333802, 
 -4099333607, -550818911, -918213513, -9148546149, -4557918864, -8230275711, 3444101184, 2678060262, -1958377003, 9087492341, -9619647384, 
 11825351148, -6689745785, -231917036, 12866573866, -10768984848, 4030707488, -7499600637, 7993537170, -2564808603, -11353509182, -750356912, 
 1361643339, 7856556282, 924556788, 9153661991, -5161252707, 12874220142, -8955516155, 7199840744, -11471598593, 743111693, 12051084460, 
 12668007738, -817444553, 3052188752, 6145488726, 8180008391, -2487720340, -508389886, 2178724444, -4953806039, -12514233491, 4785079007, 
 7048253475, 2405977185, 11012459432, 6450355099, 6576768891, 11671503746, 6926978056, -11351747711, 12821169955, -3419988292, 2218785061, 
 -6553651286, -2717336445, 4078384285, -10608872943, -9424211205, -7519439498, -3657102114, -10486697040, -8015615120, 9096524746, 6369276301, 
 3743420215, -5729660693, 3754003586, 5888093962, -5246847517, -5867070386, 9550972182, -3321694009, 10332794397, 10933535041, -7880914061, 
 6492287460, -10819503401, -4188293206, 800969720, -6195306104, 1670446451, 1140330938, 3747396641, 12776761066, -951556934, -10857312411, 
 8376816283, -6946365392, 5222855356, -3197829696, 11306427401, 1521157171, -5007023908, -2090212690, 7468091988, 3438895912, -2783963937, 
 -11378449708, -2553544297, 7943367393, -8440498759, 4655638825, -12237779152, 10595692261, -1947400595, -5597115275, 616831508, -1688167584, 
 12752407902, 3427872589, 6483669428, 3739299104, 9035671255, -6904054975, -10229393224, -11530365936, 9438351405, -4167907154, 6861572829, 
 -10310590914, -680399754, 11236382837, 1519282791, 776744187, -10521196005, 5845324274, -4932182388, -12372028673, 1500048054, 6667545163, 
 -10451616035, -116160959, 6687889499, 6350850398, -493564679, -1733910080, 3392122509, -6513704720, -5196212641, 5882577060, 9503782670, 
 2291779025, -541684080, 9754571169, -8687866150, -8066744937, -8258525865, 10128547278, -5159943081, -127297267, -292579360, 8453903877, 
 -8058128867, 4836827299, 10753089796, -7606569913, 1590303788, -5681157161, 12576698606, 5015870268, -11401185079, -5467723221, -2327667328, 
 -9089986132, 6091301019, 6976144995, 10296824271, 2513588726, -10601794344, -9423438265, -9095813140, -5529360052, 4476425697, -5149857830, 8167615570, 9133691767, -9019526746, -254468969, -3467682328, -1288076398, 589708013, -8877489298, 9850671450, 1381330575, -7646373553, -7533596263, -2365279473, 722068954, 11705161530, 12656326215, -7525470017, 7723275703, -5374849116, 7054605458, -4960318045, -4144929040, 55158915, -9979471792, -73815016, -111894143, -5423004322, 11016508917, 5645907792, 9103646813, -11928509826, 12379716322, -12114368486, -11343006092, -4247393045, -886531312, -8326274984, 3176751187, -4051797723, 6472157775, -1992392417, 1055077305, -10458425069, -1215058808, -182024859, 4207288781, -12263124322, -12514185065, 8191686280, -12316049342, 6032544899, -9965654573, 10347127493, 1584212751, 8957360482, 1381100457, -10789575311, -7283618220, 3288949232, 11758207199, -7608613953, 7031411895, 9947796174, -12137734932, -11639718649, 9421671082, -6950308060, 4849994955, 9010825797, -11689957224, 3194245766, 6405263779, 11397251663, -4791454327, 11600262052, -9312817298, -8911691282, 12334835075, 8509298546, -8682801984, 8061736488, -11439313759, 11185553266, -10756386837, -4578330576, 11483245458, -883500679, -6440965322, -8563453668, 7742742150, -12740501964, -3353504631, -7361897828, -7200889139, 9550560120, -5520669569, 1889032447, 8848561207, -7118758559, 8778498124, -2383013504, -9818105992, 10255865961, 1811972314, 7892776906, 6591340776, -9021798619, 8381822791, -3041184808, -10100533845, 2153421407, -12239785631, 7576074313, 1033238790, -2990058752, -4126186883, -7648434720, 7953802961, 1940992050, 7888889582, 11875453923, 8304190484, -12309403094, -7881709076, 2185485268, -4098902544, 2101774213, 6885589707, 12529425213, 3970207530, -7805885944, 5171414006, -4119674029, 10898828358, 2362889395, 11354370388, 2853467742, -8612449991, 5723404578, -10997886364, 5580410984, 10518563066, -6195711191, 142997326, -8545768135, -11679502641, -10237024284, 12105259266, -3880832363, 10453809717, -5369198724, 4224180753, -8766489506, 7554541035, -4913214054, 3848085682, 5335286277, 1037532403, 6066440933, -9328662421, -10389569768, -2964961900, -3592783902, 3027502524, -1045051306, 4037461877, -9219282072, -2283438585, -37892872, -322848260, 8352778449, -8012046920, 7420315618, 1198750072, -9134112294, 6790851879, 10166566521, 6437079546, 6702763923, 1070076290, 3374835882, -1681200092, 284460195, 12486881095, 11418109425, 7607928012, -3479394084, 11043640970, -1753697860, 5086306498, -2507714594, 12847007122, 11740318910, -981523776, -5455792629, -657394180, 


};




/*
 * Reduce a small signed integer modulo q. The source integer MUST
 * be between -q/2 and +q/2.
 */
static inline uint32_t
mq_conv_small(int x)
{
	/*
	 * If x < 0, the cast to uint32_t will set the high bit to 1.
	 */
	uint32_t y;

	y = (uint32_t)x;
	y += Q & -(y >> 31);
	return y;
}

static inline uint32_t
mq_conv_small_check(int x)
{
	/*
	 * If x < 0, the cast to uint32_t will set the high bit to 1.
	 */
	uint32_t y;

	y = (uint32_t)x;
	y += Q_l & -(y >> 31);
	return y;
}

/*
 * Addition modulo q. Operands must be in the 0..q-1 range.
 */
static inline uint32_t
mq_add(uint32_t x, uint32_t y)
{
	/*
	 * We compute x + y - q. If the result is negative, then the
	 * high bit will be set, and 'd >> 31' will be equal to 1;
	 * thus '-(d >> 31)' will be an all-one pattern. Otherwise,
	 * it will be an all-zero pattern. In other words, this
	 * implements a conditional addition of q.
	 */
	uint32_t d;

	d = x + y - Q;
	d += Q & -(d >> 31);
	return d;
}

static inline uint32_t
mq_add_check(uint32_t x, uint32_t y)
{
	/*
	 * We compute x + y - q. If the result is negative, then the
	 * high bit will be set, and 'd >> 31' will be equal to 1;
	 * thus '-(d >> 31)' will be an all-one pattern. Otherwise,
	 * it will be an all-zero pattern. In other words, this
	 * implements a conditional addition of q.
	 */
	uint32_t d;

	d = x + y - Q_l;
	d += Q_l & -(d >> 31);
	return d;
}

/*
 * Subtraction modulo q. Operands must be in the 0..q-1 range.
 */
static inline uint32_t
mq_sub(uint32_t x, uint32_t y)
{
	/*
	 * As in mq_add(), we use a conditional addition to ensure the
	 * result is in the 0..q-1 range.
	 */
	uint32_t d;

	d = x - y;
	d += Q & -(d >> 31);
	return d;
}

static inline uint32_t
mq_sub_check(uint32_t x, uint32_t y)
{
	/*
	 * As in mq_add(), we use a conditional addition to ensure the
	 * result is in the 0..q-1 range.
	 */
	uint32_t d;

	d = x - y;
	d += Q_l & -(d >> 31);
	return d;
}

/*
 * Division by 2 modulo q. Operand must be in the 0..q-1 range.
 */
static inline uint32_t
mq_rshift1(uint32_t x)
{
	x += Q & -(x & 1);
	return (x >> 1);
}

static inline uint32_t
mq_rshift1_check(uint32_t x)
{
	x += Q_l & -(x & 1);
	return (x >> 1);
}

/*
 * Montgomery multiplication modulo q. If we set R = 2^16 mod q, then
 * this function computes: x * y / R mod q
 * Operands must be in the 0..q-1 range.
 */
static inline uint32_t
mq_montymul(uint32_t x, uint32_t y)
{
	uint32_t z, w;

	/*
	 * We compute x*y + k*q with a value of k chosen so that the 16
	 * low bits of the result are 0. We can then shift the value.
	 * After the shift, result may still be larger than q, but it
	 * will be lower than 2*q, so a conditional subtraction works.
	 */

	z = x * y;
	w = ((z * Q0I) & 0xFFFF) * Q;

	/*
	 * When adding z and w, the result will have its low 16 bits
	 * equal to 0. Since x, y and z are lower than q, the sum will
	 * be no more than (2^15 - 1) * q + (q - 1)^2, which will
	 * fit on 29 bits.
	 */
	z = (z + w) >> 16;

	/*
	 * After the shift, analysis shows that the value will be less
	 * than 2q. We do a subtraction then conditional subtraction to
	 * ensure the result is in the expected range.
	 */
	z -= Q;
	z += Q & -(z >> 31);
	return z;
}

static inline uint32_t
mq_montymul_check(uint32_t x, uint32_t y)
{
	uint32_t z, w;

	/*
	 * We compute x*y + k*q with a value of k chosen so that the 16
	 * low bits of the result are 0. We can then shift the value.
	 * After the shift, result may still be larger than q, but it
	 * will be lower than 2*q, so a conditional subtraction works.
	 */

	z = x * y;
	w = ((z * Q0I_large) & 0xFFFF) * Q_l;

	/*
	 * When adding z and w, the result will have its low 16 bits
	 * equal to 0. Since x, y and z are lower than q, the sum will
	 * be no more than (2^15 - 1) * q + (q - 1)^2, which will
	 * fit on 29 bits.
	 */
	z = (z + w) >> 16;

	/*
	 * After the shift, analysis shows that the value will be less
	 * than 2q. We do a subtraction then conditional subtraction to
	 * ensure the result is in the expected range.
	 */
	z -= Q_l;
	z += Q_l & -(z >> 31);
	return z;
}

/*
 * Montgomery squaring (computes (x^2)/R).
 */
static inline uint32_t
mq_montysqr(uint32_t x)
{
	return mq_montymul(x, x);
}


static inline uint32_t
mq_montysqr_check(uint32_t x)
{
	return mq_montymul_check(x, x);
}
/*
 * Divide x by y modulo q = 12289.
 */
static inline uint32_t
mq_div_12289(uint32_t x, uint32_t y)
{
	/*
	 * We invert y by computing y^(q-2) mod q.
	 *
	 * We use the following addition chain for exponent e = 12287:
	 *
	 *   e0 = 1
	 *   e1 = 2 * e0 = 2
	 *   e2 = e1 + e0 = 3
	 *   e3 = e2 + e1 = 5
	 *   e4 = 2 * e3 = 10
	 *   e5 = 2 * e4 = 20
	 *   e6 = 2 * e5 = 40
	 *   e7 = 2 * e6 = 80
	 *   e8 = 2 * e7 = 160
	 *   e9 = e8 + e2 = 163
	 *   e10 = e9 + e8 = 323
	 *   e11 = 2 * e10 = 646
	 *   e12 = 2 * e11 = 1292
	 *   e13 = e12 + e9 = 1455
	 *   e14 = 2 * e13 = 2910
	 *   e15 = 2 * e14 = 5820
	 *   e16 = e15 + e10 = 6143
	 *   e17 = 2 * e16 = 12286
	 *   e18 = e17 + e0 = 12287
	 *
	 * Additions on exponents are converted to Montgomery
	 * multiplications. We define all intermediate results as so
	 * many local variables, and let the C compiler work out which
	 * must be kept around.
	 */
	uint32_t y0, y1, y2, y3, y4, y5, y6, y7, y8, y9;
	uint32_t y10, y11, y12, y13, y14, y15, y16, y17, y18;

	y0 = mq_montymul(y, R2);
	y1 = mq_montysqr(y0);
	y2 = mq_montymul(y1, y0);
	y3 = mq_montymul(y2, y1);
	y4 = mq_montysqr(y3);
	y5 = mq_montysqr(y4);
	y6 = mq_montysqr(y5);
	y7 = mq_montysqr(y6);
	y8 = mq_montysqr(y7);
	y9 = mq_montymul(y8, y2);
	y10 = mq_montymul(y9, y8);
	y11 = mq_montysqr(y10);
	y12 = mq_montysqr(y11);
	y13 = mq_montymul(y12, y9);
	y14 = mq_montysqr(y13);
	y15 = mq_montysqr(y14);
	y16 = mq_montymul(y15, y10);
	y17 = mq_montysqr(y16);
	y18 = mq_montymul(y17, y0);

	/*
	 * Final multiplication with x, which is not in Montgomery
	 * representation, computes the correct division result.
	 */
	return mq_montymul(y18, x);
}


static inline uint32_t
mq_div_12289_check(uint32_t x, uint32_t y)
{
	/*
	 * We invert y by computing y^(q-2) mod q.
	 *
	 * We use the following addition chain for exponent e = 12287:
	 *
	 *   e0 = 1
	 *   e1 = 2 * e0 = 2
	 *   e2 = e1 + e0 = 3
	 *   e3 = e2 + e1 = 5
	 *   e4 = 2 * e3 = 10
	 *   e5 = 2 * e4 = 20
	 *   e6 = 2 * e5 = 40
	 *   e7 = 2 * e6 = 80
	 *   e8 = 2 * e7 = 160
	 *   e9 = e8 + e2 = 163
	 *   e10 = e9 + e8 = 323
	 *   e11 = 2 * e10 = 646
	 *   e12 = 2 * e11 = 1292
	 *   e13 = e12 + e9 = 1455
	 *   e14 = 2 * e13 = 2910
	 *   e15 = 2 * e14 = 5820
	 *   e16 = e15 + e10 = 6143
	 *   e17 = 2 * e16 = 12286
	 *   e18 = e17 + e0 = 12287
	 *
	 * Additions on exponents are converted to Montgomery
	 * multiplications. We define all intermediate results as so
	 * many local variables, and let the C compiler work out which
	 * must be kept around.
	 */
	uint32_t y0, y1, y2, y3, y4, y5, y6, y7, y8, y9;
	uint32_t y10, y11, y12, y13, y14, y15, y16, y17, y18;

	y0 = mq_montymul_check(y, R2);
	y1 = mq_montysqr_check(y0);
	y2 = mq_montymul_check(y1, y0);
	y3 = mq_montymul_check(y2, y1);
	y4 = mq_montysqr_check(y3);
	y5 = mq_montysqr_check(y4);
	y6 = mq_montysqr_check(y5);
	y7 = mq_montysqr_check(y6);
	y8 = mq_montysqr_check(y7);
	y9 = mq_montymul_check(y8, y2);
	y10 = mq_montymul_check(y9, y8);
	y11 = mq_montysqr_check(y10);
	y12 = mq_montysqr_check(y11);
	y13 = mq_montymul_check(y12, y9);
	y14 = mq_montysqr_check(y13);
	y15 = mq_montysqr_check(y14);
	y16 = mq_montymul_check(y15, y10);
	y17 = mq_montysqr_check(y16);
	y18 = mq_montymul_check(y17, y0);

	/*
	 * Final multiplication with x, which is not in Montgomery
	 * representation, computes the correct division result.
	 */
	return mq_montymul_check(y18, x);
}

/*
 * Compute NTT on a ring element.
 */
static void
mq_NTT(uint16_t *a, unsigned logn)
{
	size_t n, t, m;

	n = (size_t)1 << logn;
	t = n;
	for (m = 1; m < n; m <<= 1) {
		size_t ht, i, j1;

		ht = t >> 1;
		for (i = 0, j1 = 0; i < m; i ++, j1 += t) {
			size_t j, j2;
			uint32_t s;

			s = GMb[m + i];
			j2 = j1 + ht;
			for (j = j1; j < j2; j ++) {
				uint32_t u, v;

				u = a[j];
				v = mq_montymul(a[j + ht], s);
				a[j] = (uint16_t)mq_add(u, v);
				a[j + ht] = (uint16_t)mq_sub(u, v);
			}
		}
		t = ht;
	}
}

static void
mq_NTT_check(uint32_t *a, unsigned logn)
{
	size_t n, t, m;

	n = (size_t)1 << logn;
	t = n;
	for (m = 1; m < n; m <<= 1) {
		size_t ht, i, j1;

		ht = t >> 1;
		for (i = 0, j1 = 0; i < m; i ++, j1 += t) {
			size_t j, j2;
			uint32_t s;

			s = GMb_large[m + i];
			j2 = j1 + ht;
			for (j = j1; j < j2; j ++) {
				uint32_t u, v;

				u = a[j];
				v = mq_montymul_check(a[j + ht], s);
				a[j] = (uint32_t)mq_add_check(u, v);
				a[j + ht] = (uint32_t)mq_sub_check(u, v);
			}
		}
		t = ht;
	}
}

/*
 * Compute the inverse NTT on a ring element, binary case.
 */
static void
mq_iNTT(uint16_t *a, unsigned logn)
{
	size_t n, t, m;
	uint32_t ni;

	n = (size_t)1 << logn;
	t = 1;
	m = n;
	while (m > 1) {
		size_t hm, dt, i, j1;

		hm = m >> 1;
		dt = t << 1;
		for (i = 0, j1 = 0; i < hm; i ++, j1 += dt) {
			size_t j, j2;
			uint32_t s;

			j2 = j1 + t;
			s = iGMb[hm + i];
			for (j = j1; j < j2; j ++) {
				uint32_t u, v, w;

				u = a[j];
				v = a[j + t];
				a[j] = (uint16_t)mq_add(u, v);
				w = mq_sub(u, v);
				a[j + t] = (uint16_t)
					mq_montymul(w, s);
			}
		}
		t = dt;
		m = hm;
	}

	/*
	 * To complete the inverse NTT, we must now divide all values by
	 * n (the vector size). We thus need the inverse of n, i.e. we
	 * need to divide 1 by 2 logn times. But we also want it in
	 * Montgomery representation, i.e. we also want to multiply it
	 * by R = 2^16. In the common case, this should be a simple right
	 * shift. The loop below is generic and works also in corner cases;
	 * its computation time is negligible.
	 */
	ni = R;
	for (m = n; m > 1; m >>= 1) {
		ni = mq_rshift1(ni);
	}
	for (m = 0; m < n; m ++) {
		a[m] = (uint16_t)mq_montymul(a[m], ni);
	}
}


static void
mq_iNTT_check(uint32_t *a, unsigned logn)
{
	size_t n, t, m;
	uint32_t ni;

	n = (size_t)1 << logn;
	t = 1;
	m = n;
	while (m > 1) {
		size_t hm, dt, i, j1;

		hm = m >> 1;
		dt = t << 1;
		for (i = 0, j1 = 0; i < hm; i ++, j1 += dt) {
			size_t j, j2;
			uint32_t s;

			j2 = j1 + t;
			s = iGMb_large[hm + i];
			for (j = j1; j < j2; j ++) {
				uint32_t u, v, w;

				u = a[j];
				v = a[j + t];
				a[j] = (uint32_t)mq_add_check(u, v);
				w = mq_sub_check(u, v);
				a[j + t] = (uint32_t)
					mq_montymul_check(w, s);
			}
		}
		t = dt;
		m = hm;
	}

	/*
	 * To complete the inverse NTT, we must now divide all values by
	 * n (the vector size). We thus need the inverse of n, i.e. we
	 * need to divide 1 by 2 logn times. But we also want it in
	 * Montgomery representation, i.e. we also want to multiply it
	 * by R = 2^16. In the common case, this should be a simple right
	 * shift. The loop below is generic and works also in corner cases;
	 * its computation time is negligible.
	 */
	ni = R;
	for (m = n; m > 1; m >>= 1) {
		ni = mq_rshift1_check(ni);
	}
	for (m = 0; m < n; m ++) {
		a[m] = (uint32_t)mq_montymul_check(a[m], ni);
	}
}


/*
 * Convert a polynomial (mod q) to Montgomery representation.
 */
static void
mq_poly_tomonty(uint16_t *f, unsigned logn)
{
	size_t u, n;

	n = (size_t)1 << logn;
	for (u = 0; u < n; u ++) {
		f[u] = (uint16_t)mq_montymul(f[u], R2);
	}
}

static void
mq_poly_tomonty_check(uint32_t *f, unsigned logn)
{
	size_t u, n;

	n = (size_t)1 << logn;
	for (u = 0; u < n; u ++) {
		f[u] = (uint32_t)mq_montymul_check(f[u], R2);
	}
}

/*
 * Multiply two polynomials together (NTT representation, and using
 * a Montgomery multiplication). Result f*g is written over f.
 */
static void
mq_poly_montymul_ntt(uint16_t *f, const uint16_t *g, unsigned logn)
{
	size_t u, n;

	n = (size_t)1 << logn;
	for (u = 0; u < n; u ++) {
		f[u] = (uint16_t)mq_montymul(f[u], g[u]);
	}
}

static void
mq_poly_montymul_ntt_check(uint16_t *f, const uint16_t *g, unsigned logn)
{
	size_t u, n;

	n = (size_t)1 << logn;
	for (u = 0; u < n; u ++) {
		f[u] = (uint16_t)mq_montymul_check(f[u], g[u]);
	}
}

/*
 * Subtract polynomial g from polynomial f.
 */
static void
mq_poly_sub(uint16_t *f, const uint16_t *g, unsigned logn)
{
	size_t u, n;

	n = (size_t)1 << logn;
	for (u = 0; u < n; u ++) {
		f[u] = (uint16_t)mq_sub(f[u], g[u]);
	}
}

static void
mq_poly_sub_check(uint16_t *f, const uint32_t *g, unsigned logn)
{
	size_t u, n;

	n = (size_t)1 << logn;
	for (u = 0; u < n; u ++) {
		f[u] = (uint16_t)mq_sub(f[u], g[u]);
	}
}

// static void
// mq_poly_sub(uint16_t *f, const uint16_t *g, unsigned logn)
// {
// 	size_t u, n;

// 	n = (size_t)1 << logn;
// 	for (u = 0; u < n; u ++) {
// 		f[u] = (uint16_t)mq_sub(f[u], g[u]);
// 	}
// }

/* ===================================================================== */

/* see inner.h */
void
Zf(to_ntt_monty)(uint16_t *h, unsigned logn)
{
	mq_NTT(h, logn);
	mq_poly_tomonty(h, logn);
}


int
Zf(verify_raw_check)(const uint32_t *c0, const int16_t *s2,
	const uint16_t *h, unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint16_t *tt;
	int mod = 4194304;

	n = (size_t)1 << logn;
	tt = (uint16_t *)tmp;

	/*
	 * Reduce s2 elements modulo q ([0..q-1] range).
	 */
	for (u = 0; u < n; u ++) {
		uint32_t w;

		w = (uint32_t)s2[u];
		w += Q & -(w >> 31);
		tt[u] = (uint16_t)w;
	}

	/*
	 * Compute -s1 = s2*h - c0 mod phi mod q (in tt[]).
	 */
	mq_NTT(tt, logn);
	mq_poly_montymul_ntt(tt, h, logn);
	mq_iNTT(tt, logn);
	mq_poly_sub_check(tt, c0, logn);

	/*
	 * Normalize -s1 elements into the [-q/2..q/2] range.
	 */
	for (u = 0; u < n; u ++) {
		int32_t w;

		w = (int32_t)tt[u];
		w -= (int32_t)(Q & -(((Q >> 1) - (uint32_t)w) >> 31));
		((int16_t *)tt)[u] = (int16_t)w;
	}

	/*
	 * Signature is valid if and only if the aggregate (-s1,s2) vector
	 * is short enough.
	 */
	return Zf(is_short)((int16_t *)tt, s2, logn);
}

/* see inner.h */
int
Zf(verify_raw)(const uint16_t *c0, const int16_t *s2,
	const uint16_t *h, unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint16_t *tt;

	n = (size_t)1 << logn;
	tt = (uint16_t *)tmp;

	/*
	 * Reduce s2 elements modulo q ([0..q-1] range).
	 */
	for (u = 0; u < n; u ++) {
		uint32_t w;

		w = (uint32_t)s2[u];
		w += Q & -(w >> 31);
		tt[u] = (uint16_t)w;
	}

	/*
	 * Compute -s1 = s2*h - c0 mod phi mod q (in tt[]).
	 */
	mq_NTT(tt, logn);
	mq_poly_montymul_ntt(tt, h, logn);
	mq_iNTT(tt, logn);
	mq_poly_sub(tt, c0, logn);

	/*
	 * Normalize -s1 elements into the [-q/2..q/2] range.
	 */
	for (u = 0; u < n; u ++) {
		int32_t w;

		w = (int32_t)tt[u];
		w -= (int32_t)(Q & -(((Q >> 1) - (uint32_t)w) >> 31));
		((int16_t *)tt)[u] = (int16_t)w;
	}

	// for (u = 0; u < n; u ++) {

	// 	printf("%d \t %d\n",tt[u],s2[u]);

	// }

	/*
	 * Signature is valid if and only if the aggregate (-s1,s2) vector
	 * is short enough.
	 */
	return Zf(is_short)((int16_t *)tt, s2, logn);
}

/* see inner.h */
int
Zf(compute_public)(uint16_t *h,
	const int8_t *f, const int8_t *g, unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint16_t *tt;

	n = (size_t)1 << logn;
	tt = (uint16_t *)tmp;
	for (u = 0; u < n; u ++) {
		tt[u] = (uint16_t)mq_conv_small(f[u]);
		h[u] = (uint16_t)mq_conv_small(g[u]);
	}
	mq_NTT(h, logn);
	mq_NTT(tt, logn);
	for (u = 0; u < n; u ++) {
		if (tt[u] == 0) {
			return 0;
		}
		h[u] = (uint16_t)mq_div_12289(h[u], tt[u]);
	}
	mq_iNTT(h, logn);
	return 1;
}


int
Zf(compute_public_check)(uint32_t *h,
	const int8_t *f, const int8_t *g, unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint32_t *tt;

	n = (size_t)1 << logn;
	tt = (uint32_t *)tmp;
	for (u = 0; u < n; u ++) {
		tt[u] = (uint32_t)mq_conv_small_check(f[u]);
		h[u] = (uint32_t)mq_conv_small_check(g[u]);
	}
	mq_NTT_check(h, logn);
	mq_NTT_check(tt, logn);
	for (u = 0; u < n; u ++) {
		if (tt[u] == 0) {
			return 0;
		}
		h[u] = (uint16_t)mq_div_12289_check(h[u], tt[u]);
	}
	mq_iNTT_check(h, logn);

	return 1;
}

/* see inner.h */
int
Zf(complete_private)(int8_t *G,
	const int8_t *f, const int8_t *g, const int8_t *F,
	unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint16_t *t1, *t2;

	n = (size_t)1 << logn;
	t1 = (uint16_t *)tmp;
	t2 = t1 + n;
	for (u = 0; u < n; u ++) {
		t1[u] = (uint16_t)mq_conv_small(g[u]);
		t2[u] = (uint16_t)mq_conv_small(F[u]);
	}
	mq_NTT(t1, logn);
	mq_NTT(t2, logn);
	mq_poly_tomonty(t1, logn);
	mq_poly_montymul_ntt(t1, t2, logn);
	for (u = 0; u < n; u ++) {
		t2[u] = (uint16_t)mq_conv_small(f[u]);
	}
	mq_NTT(t2, logn);
	for (u = 0; u < n; u ++) {
		if (t2[u] == 0) {
			return 0;
		}
		t1[u] = (uint16_t)mq_div_12289(t1[u], t2[u]);
	}
	mq_iNTT(t1, logn);
	for (u = 0; u < n; u ++) {
		uint32_t w;
		int32_t gi;

		w = t1[u];
		w -= (Q & ~-((w - (Q >> 1)) >> 31));
		gi = *(int32_t *)&w;
		if (gi < -127 || gi > +127) {
			return 0;
		}
		G[u] = (int8_t)gi;
	}
	return 1;
}


int
Zf(complete_private_check)(int8_t *G,
	const int8_t *f, const int8_t *g, const int8_t *F,
	unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint32_t *t1, *t2;

	n = (size_t)1 << logn;
	t1 = (uint32_t *)tmp;
	t2 = t1 + n;
	for (u = 0; u < n; u ++) {
		t1[u] = (uint32_t)mq_conv_small_check(g[u]);
		t2[u] = (uint32_t)mq_conv_small_check(F[u]);
	}

	mq_NTT_check(t1, logn);
	mq_NTT_check(t2, logn);
	mq_poly_tomonty_check(t1, logn);
	//mq_poly_montymul_ntt_check(t1, t2, logn); // TODO: bring it back
	
	for (u = 0; u < n; u ++) {
		t2[u] = (uint16_t)mq_conv_small_check(f[u]);
	}
	mq_NTT_check(t2, logn);
	for (u = 0; u < n; u ++) {
		if (t2[u] == 0) {
			return 0;
		}
		t1[u] = (uint16_t)mq_div_12289_check(t1[u], t2[u]);
	}
	mq_iNTT_check(t1, logn);
	for (u = 0; u < n; u ++) {
		uint32_t w;
		int32_t gi;

		w = t1[u];
		w -= (Q_l & ~-((w - (Q_l >> 1)) >> 31));
		gi = *(int32_t *)&w;
		if (gi < -127 || gi > +127) {
			return 0;
		}
		G[u] = (int8_t)gi;
	}
	return 1;
}



/* see inner.h */
int
Zf(is_invertible)(
	const int16_t *s2, unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint16_t *tt;
	uint32_t r;

	n = (size_t)1 << logn;
	tt = (uint16_t *)tmp;
	for (u = 0; u < n; u ++) {
		uint32_t w;

		w = (uint32_t)s2[u];
		w += Q & -(w >> 31);
		tt[u] = (uint16_t)w;
	}
	mq_NTT(tt, logn);
	r = 0;
	for (u = 0; u < n; u ++) {
		r |= (uint32_t)(tt[u] - 1);
	}
	return (int)(1u - (r >> 31));
}

/* see inner.h */
int
Zf(verify_recover)(uint16_t *h,
	const uint16_t *c0, const int16_t *s1, const int16_t *s2,
	unsigned logn, uint8_t *tmp)
{
	size_t u, n;
	uint16_t *tt;
	uint32_t r;

	n = (size_t)1 << logn;

	/*
	 * Reduce elements of s1 and s2 modulo q; then write s2 into tt[]
	 * and c0 - s1 into h[].
	 */
	tt = (uint16_t *)tmp;
	for (u = 0; u < n; u ++) {
		uint32_t w;

		w = (uint32_t)s2[u];
		w += Q & -(w >> 31);
		tt[u] = (uint16_t)w;

		w = (uint32_t)s1[u];
		w += Q & -(w >> 31);
		w = mq_sub(c0[u], w);
		h[u] = (uint16_t)w;
	}

	/*
	 * Compute h = (c0 - s1) / s2. If one of the coefficients of s2
	 * is zero (in NTT representation) then the operation fails. We
	 * keep that information into a flag so that we do not deviate
	 * from strict constant-time processing; if all coefficients of
	 * s2 are non-zero, then the high bit of r will be zero.
	 */
	mq_NTT(tt, logn);
	mq_NTT(h, logn);
	r = 0;
	for (u = 0; u < n; u ++) {
		r |= (uint32_t)(tt[u] - 1);
		h[u] = (uint16_t)mq_div_12289(h[u], tt[u]);
	}
	mq_iNTT(h, logn);

	/*
	 * Signature is acceptable if and only if it is short enough,
	 * and s2 was invertible mod phi mod q. The caller must still
	 * check that the rebuilt public key matches the expected
	 * value (e.g. through a hash).
	 */
	r = ~r & (uint32_t)-Zf(is_short)(s1, s2, logn);
	return (int)(r >> 31);
}

/* see inner.h */
int
Zf(count_nttzero)(const int16_t *sig, unsigned logn, uint8_t *tmp)
{
	uint16_t *s2;
	size_t u, n;
	uint32_t r;

	n = (size_t)1 << logn;
	s2 = (uint16_t *)tmp;
	for (u = 0; u < n; u ++) {
		uint32_t w;

		w = (uint32_t)sig[u];
		w += Q & -(w >> 31);
		s2[u] = (uint16_t)w;
	}
	mq_NTT(s2, logn);
	r = 0;
	for (u = 0; u < n; u ++) {
		uint32_t w;

		w = (uint32_t)s2[u] - 1u;
		r += (w >> 31);
	}
	return (int)r;
}
